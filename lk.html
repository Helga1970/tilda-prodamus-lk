<script>
        // Проверяем авторизацию при загрузке страницы
        window.onload = function() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    // ИСПРАВЛЕНО: перенаправляем на главную страницу входа
                    window.location.href = 'index.html'; 
                    return;
                }
            } catch (e) {
                console.error('Ошибка при чтении токена из localStorage:', e);
                localStorage.removeItem('token');
                // ИСПРАВЛЕНО: перенаправляем на главную страницу входа
                window.location.href = 'index.html';
                return;
            }
            equalizeTiles();
        };

        document.getElementById('logoutButton').addEventListener('click', function() {
            localStorage.removeItem('token');
            // ИСПРАВЛЕНО: перенаправляем на главную страницу входа
            window.location.href = 'index.html'; 
        });
        
        const checkAndRedirect = async () => {
            const token = localStorage.getItem('token');
            
            if (!token) {
                alert('Ошибка: токен не найден. Пожалуйста, попробуйте войти снова.');
                window.location.href = 'index.html'; // ИСПРАВЛЕНО: перенаправляем на главную страницу входа
                return;
            }

            try {
                const response = await fetch('/.netlify/functions/get-content?action=check-access', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    window.location.href = 'https://pro-culinaria-library.proculinaria-book.ru/?access=true';
                } else {
                    const errorData = await response.json();
                    alert(`Ошибка: ${errorData.message || 'Ошибка доступа'}`);
                }

            } catch (e) {
                console.error('Ошибка:', e);
                alert('Произошла ошибка при получении доступа к материалам. Пожалуйста, попробуйте позже.');
            }
        };

        function equalizeTiles() {
            const tiles = Array.from(document.querySelectorAll('.links-section .lk-link'));
            if (!tiles.length) return;
            tiles.forEach(t => t.style.height = 'auto');
            let max = 0;
            tiles.forEach(t => {
                const h = t.offsetHeight;
                if (h > max) max = h;
            });
            if (max < 50) max = 50;
            tiles.forEach(t => t.style.height = max + 'px');
        }

        let _resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(_resizeTimer);
            _resizeTimer = setTimeout(equalizeTiles, 120);
        });

        document.fonts && document.fonts.ready.then(equalizeTiles).catch(()=>{});
    </script>
